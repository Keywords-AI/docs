---
title: "Anthropic Agents"
description: "Trace Anthropic Agent SDK workflows, tool calls, and sub-agents with Respan."
---

<Accordion title="Set up Respan">
1. **Sign up** — Create an account at [platform.respan.ai](https://platform.respan.ai)
2. **Create an API key** — Generate one on the [API keys page](https://platform.respan.ai/platform/api/api-keys)
3. **Add credits or a provider key** — Add credits on the [Credits page](https://platform.respan.ai/platform/api/credits) or connect your own provider key on the [Integrations page](https://platform.respan.ai/platform/api/integrations)
</Accordion>

## What is Anthropic Agent SDK?

The [Anthropic Agent SDK](https://github.com/anthropics/anthropic-agent-sdk) (`claude-agent-sdk`) is a framework for building agent workflows powered by Claude. It supports tool use, sub-agent delegation, and structured conversations. The Respan exporter hooks into the SDK's lifecycle events to capture full trace data.

<Check>
Example projects:
- [Python](https://github.com/respanai/respan-example-projects/tree/main/python/tracing/anthropic-agents-sdk)
- [TypeScript](https://github.com/respanai/respan-example-projects/tree/main/typescript/tracing/anthropic-agents-sdk)
</Check>

## Setup

<Steps>
<Step title="Install packages">

<CodeGroup>
```bash Python
pip install claude-agent-sdk respan-exporter-anthropic-agents
```
```bash JavaScript
npm install @anthropic-ai/claude-agent-sdk @respan/exporter-anthropic-agents
```
</CodeGroup>

</Step>

<Step title="Set environment variables">

```bash
export RESPAN_API_KEY="YOUR_RESPAN_API_KEY"
export RESPAN_BASE_URL="https://api.respan.ai/api"
export ANTHROPIC_API_KEY="YOUR_ANTHROPIC_API_KEY"
```

</Step>

<Step title="Initialize and run">

<CodeGroup>
```python Python
from claude_agent_sdk import create_agent
from respan_exporter_anthropic_agents import RespanAnthropicAgentsExporter

exporter = RespanAnthropicAgentsExporter()

options = exporter.with_options({
    "model": "claude-sonnet-4-5-20250929",
    "max_tokens": 1024,
})

agent = create_agent(options)
result = agent.query("Tell me a joke about AI")
print(result)
```
```typescript JavaScript
import { RespanAnthropicAgentsExporter } from '@respan/exporter-anthropic-agents';

const exporter = new RespanAnthropicAgentsExporter({
  apiKey: process.env.RESPAN_API_KEY!,
});

const options = exporter.withOptions({
  model: 'claude-sonnet-4-5-20250929',
  maxTokens: 1024,
});

const result = await exporter.query({
  prompt: 'Tell me a joke about AI',
  options,
});
console.log(result);
```
</CodeGroup>

</Step>

<Step title="View your trace">

Open the [Traces page](https://platform.respan.ai/platform/traces) to see your agent trace.

</Step>
</Steps>

## Configuration

### Python

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `api_key` | `str` | `RESPAN_API_KEY` env var | Respan API key. |
| `base_url` | `str` | `RESPAN_BASE_URL` env var | API base URL. |
| `endpoint` | `str \| None` | `None` | Custom ingest endpoint URL. |

### JavaScript

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `apiKey` | `string` | — | Respan API key. |
| `baseUrl` | `string \| undefined` | `undefined` | API base URL. |
| `endpoint` | `string \| undefined` | `undefined` | Custom ingest endpoint URL. |

See the Anthropic Agents Exporter SDK reference for [Python](/sdks/python/exporters/anthropic-agents) or [TypeScript](/sdks/typescript/exporters/anthropic-agents).

## Wrapped query

The simplest integration pattern — `exporter.query()` handles tracing hooks automatically:

```python
from claude_agent_sdk import ClaudeAgentOptions
from respan_exporter_anthropic_agents import RespanAnthropicAgentsExporter

exporter = RespanAnthropicAgentsExporter()

async for message in exporter.query(
    prompt="Name three primary colors.",
    options=ClaudeAgentOptions(
        permission_mode="bypassPermissions",
        max_turns=1,
    ),
):
    print(type(message).__name__)
```

## Tool use

Tool calls are automatically captured as child spans with inputs and outputs:

```python
from claude_agent_sdk import ClaudeAgentOptions
from respan_exporter_anthropic_agents import RespanAnthropicAgentsExporter

exporter = RespanAnthropicAgentsExporter()

async for message in exporter.query(
    prompt="List the Python files in the current directory.",
    options=ClaudeAgentOptions(
        permission_mode="bypassPermissions",
        max_turns=3,
        allowed_tools=["Read", "Glob", "Grep"],
    ),
):
    print(type(message).__name__)
```

## Respan Gateway

Route Claude API calls through the Respan gateway — only a single `RESPAN_API_KEY` is needed for both the LLM call and trace export:

```python
from claude_agent_sdk import ClaudeAgentOptions
from respan_exporter_anthropic_agents import RespanAnthropicAgentsExporter

RESPAN_API_KEY = "YOUR_RESPAN_API_KEY"

exporter = RespanAnthropicAgentsExporter(
    api_key=RESPAN_API_KEY,
    base_url="https://api.respan.ai/api",
)

options = ClaudeAgentOptions(
    permission_mode="bypassPermissions",
    max_turns=1,
    env={
        "ANTHROPIC_BASE_URL": "https://api.respan.ai/api",
        "ANTHROPIC_AUTH_TOKEN": RESPAN_API_KEY,
        "ANTHROPIC_API_KEY": RESPAN_API_KEY,
    },
)

async for message in exporter.query(
    prompt="Tell me a joke about AI",
    options=options,
):
    print(type(message).__name__)
```
